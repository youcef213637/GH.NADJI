<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ø³Ù„Ø©</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>ğŸ›’ Ø§Ù„Ø³Ù„Ø©</h2>
  <div id="cart-list"></div>
  <p>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">0 Ø¯Ø¬</span></p>
  <button id="clear">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</button>
  <button id="checkout">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡</button>

  <script>
    function renderCart() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const list = document.getElementById('cart-list');
      list.innerHTML = '';
      let total = 0;

      cart.forEach((item, idx) => {
        const subtotal = item.price * item.quantity;
        total += subtotal;
        list.innerHTML += `
          <div>
            ${item.name} Ã— ${item.quantity} â€” ${item.price} Ø¯Ø¬
            <button onclick="removeItem(${idx})">âŒ</button>
          </div>
        `;
      });

      document.getElementById('total').textContent = total + ' Ø¯Ø¬';
    }

    function removeItem(i) {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      cart.splice(i, 1);
      localStorage.setItem('cart', JSON.stringify(cart));
      renderCart();
    }

    document.getElementById('clear').addEventListener('click', () => {
      localStorage.removeItem('cart');
      renderCart();
    });

    document.getElementById('checkout').addEventListener('click', () => {
      const cartItems = JSON.parse(localStorage.getItem('cart') || '[]');
      const user = JSON.parse(localStorage.getItem('currentUser') || '{}');

      if (!user.email) {
        alert('âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
        window.location.href = 'login.html';
        return;
      }

      if (cartItems.length === 0) {
        alert('âŒ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©');
        return;
      }

      const orders = JSON.parse(localStorage.getItem('orders') || '[]');
      const order = {
        customer: user,
        items: cartItems,
        total: cartItems.reduce((sum, i) => sum + i.price * i.quantity, 0),
        date: new Date().toLocaleString()
      };

      orders.push(order);
      localStorage.setItem('orders', JSON.stringify(orders));
      localStorage.removeItem('cart');
      renderCart();

      alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ØŒ Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ÙŠØ§ ' + user.name);
    });

    renderCart();
  </script>
</body>
</html>
